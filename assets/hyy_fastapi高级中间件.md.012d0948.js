import{_ as s,c as a,o as n,a as p}from"./app.a7fc1445.js";const A=JSON.parse('{"title":"fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6","description":"","frontmatter":{},"headers":[{"level":3,"title":"app.add_middleware( )\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6","slug":"app-add-middleware-\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6","link":"#app-add-middleware-\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6","children":[]}],"relativePath":"hyy/fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6.md"}'),l={name:"hyy/fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6.md"},e=p(`<h1 id="fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6" tabindex="-1">fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#fastapi\u9AD8\u7EA7\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h1><h3 id="app-add-middleware-\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6" tabindex="-1">app.add_middleware( )\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#app-add-middleware-\u64CD\u4F5C\u5F15\u5165\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h3><div class="language-python line-numbers-mode"><button class="copy"></button><span class="lang">python</span><pre><code><span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FastAPI</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> unicorn </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> UnicornMiddleware</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FastAPI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_middleware</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">UnicornMiddleware</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">some_config</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rainbow</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7B2C\u4E00\u4E2A\u53C2\u6570\u662F\u4E2D\u95F4\u4EF6\u7C7B\uFF0C\u540C\u65F6\u8FD8\u652F\u6301\u5176\u4ED6\u9644\u52A0\u4FE1\u606F</p><h5 id="_1\u3001httpsredirectmiddleware\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u534F\u8BAE\u5FC5\u987B\u662Fhttps\u6216\u8005wss" tabindex="-1">1\u3001<code>HTTPSRedirectMiddleware</code>\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u534F\u8BAE\u5FC5\u987B\u662Fhttps\u6216\u8005wss <a class="header-anchor" href="#_1\u3001httpsredirectmiddleware\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u534F\u8BAE\u5FC5\u987B\u662Fhttps\u6216\u8005wss" aria-hidden="true">#</a></h5><div class="language-python line-numbers-mode"><button class="copy"></button><span class="lang">python</span><pre><code><span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FastAPI</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middleware</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">httpsredirect </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> HTTPSRedirectMiddleware</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FastAPI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_middleware</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">HTTPSRedirectMiddleware</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#!!</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="_2\u3001trustedhostmiddleware\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u5FC5\u987B\u5728header\u4FE1\u606F\u4E2D\uFF0C\u8BBE\u7F6E\u4E86host\u9009\u9879\uFF0C\u4E3A\u4E86\u907F\u514D-http-host-header\u653B\u51FB-\u3002" tabindex="-1">2\u3001<code>TrustedHostMiddleware</code>\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u5FC5\u987B\u5728header\u4FE1\u606F\u4E2D\uFF0C\u8BBE\u7F6E\u4E86Host\u9009\u9879\uFF0C\u4E3A\u4E86\u907F\u514D HTTP Host Header\u653B\u51FB \u3002 <a class="header-anchor" href="#_2\u3001trustedhostmiddleware\u5F3A\u5236\u53D1\u6765\u7684\u8BF7\u6C42\u5FC5\u987B\u5728header\u4FE1\u606F\u4E2D\uFF0C\u8BBE\u7F6E\u4E86host\u9009\u9879\uFF0C\u4E3A\u4E86\u907F\u514D-http-host-header\u653B\u51FB-\u3002" aria-hidden="true">#</a></h5><div class="language-python line-numbers-mode"><button class="copy"></button><span class="lang">python</span><pre><code><span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FastAPI</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middleware</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">trustedhost </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> TrustedHostMiddleware</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FastAPI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_middleware</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    TrustedHostMiddleware</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">allowed_hosts</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">example.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*.example.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="_3\u3001gzipmiddleware\u5B8C\u6210\u76F8\u5E94\u7684\u8FD4\u56DE\u7ED3\u679C\u5904\u7406" tabindex="-1">3\u3001<code>GZipMiddleware</code>\u5B8C\u6210\u76F8\u5E94\u7684\u8FD4\u56DE\u7ED3\u679C\u5904\u7406 <a class="header-anchor" href="#_3\u3001gzipmiddleware\u5B8C\u6210\u76F8\u5E94\u7684\u8FD4\u56DE\u7ED3\u679C\u5904\u7406" aria-hidden="true">#</a></h5><p>\uFF08\u5F53\u8BF7\u6C42\u7684\u5934\u4FE1\u606F <em><code>Accept-Encoding</code></em> \u5B57\u6BB5\u5E26\u6709&quot;gzip&quot;\u65F6 \uFF09</p><p><code>GZipMiddleware</code> \u652F\u6301 <em><code>minimum_size</code></em> \u53C2\u6570\uFF1A\u5F53\u8FD4\u56DE\u7ED3\u679C\u5927\u5C0F\u5C0F\u4E8E\u6307\u5B9A\u503C\u65F6\u4E0D\u542F\u7528\u538B\u7F29\u3002(\u5355\u4F4D\u4E3A\u5B57\u8282\uFF0C\u9ED8\u8BA4\u503C\u4E3A500)</p><div class="language-python line-numbers-mode"><button class="copy"></button><span class="lang">python</span><pre><code><span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FastAPI</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> fastapi</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middleware</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gzip </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> GZipMiddleware</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FastAPI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_middleware</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">GZipMiddleware</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">minimum_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">somebigcontent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div>`,12),o=[e];function r(c,t,D,F,i,y){return n(),a("div",null,o)}const C=s(l,[["render",r]]);export{A as __pageData,C as default};
